<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Robert Schlegel" />

<meta name="date" content="2020-02-25" />

<title>Preparing the data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MHW air-sea heat flux</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="polygon-prep.html">Study area preparation</a>
    </li>
    <li>
      <a href="data-prep.html">Data preparation</a>
    </li>
    <li>
      <a href="mhw-flux.html">MHWs vs. heat flux</a>
    </li>
    <li>
      <a href="som.html">SOM analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/robwschlegel/MHWflux">
    <span class="fas fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Preparing the data</h1>
<h4 class="author">Robert Schlegel</h4>
<h4 class="date">2020-02-25</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2021-01-24
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>MHWflux/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed666code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(666)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed666code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(666)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomrobwschlegelMHWfluxtree6554bc80ac899fca286505fa0781eeeeda6e5743targetblank6554bc8a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/robwschlegel/MHWflux/tree/6554bc80ac899fca286505fa0781eeeeda6e5743" target="_blank">6554bc8</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomrobwschlegelMHWfluxtree6554bc80ac899fca286505fa0781eeeeda6e5743targetblank6554bc8a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/robwschlegel/MHWflux/tree/6554bc80ac899fca286505fa0781eeeeda6e5743" target="_blank">6554bc8</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    data/ALL_anom.Rda
    Ignored:    data/ALL_other.Rda
    Ignored:    data/ALL_ts_anom.Rda
    Ignored:    data/ERA5_down.Rda
    Ignored:    data/ERA5_down_anom.Rda
    Ignored:    data/ERA5_evp_anom.Rda
    Ignored:    data/ERA5_lhf_anom.Rda
    Ignored:    data/ERA5_lwr_anom.Rda
    Ignored:    data/ERA5_mslp_anom.Rda
    Ignored:    data/ERA5_pcp_anom.Rda
    Ignored:    data/ERA5_qnet_anom.Rda
    Ignored:    data/ERA5_shf_anom.Rda
    Ignored:    data/ERA5_swr_MLD.Rda
    Ignored:    data/ERA5_swr_anom.Rda
    Ignored:    data/ERA5_t2m_anom.Rda
    Ignored:    data/ERA5_tcc_anom.Rda
    Ignored:    data/ERA5_u_anom.Rda
    Ignored:    data/ERA5_v_anom.Rda
    Ignored:    data/GLORYS_all_anom.Rda
    Ignored:    data/OISST_all_anom.Rda
    Ignored:    data/packet.Rda
    Ignored:    data/som.Rda
    Ignored:    data/synoptic_states.Rda
    Ignored:    data/synoptic_states_other.Rda

Untracked files:
    Untracked:  data/event_overlap_res.Rda

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/data-prep.Rmd</code>) and HTML (<code>docs/data-prep.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/57e2ce3c9890cbe7e9df4b9e072571128a557900/docs/data-prep.html" target="_blank">57e2ce3</a>
</td>
<td>
robwschlegel
</td>
<td>
2021-01-23
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/76b55b6d7b630ece96e46f5df838db902f4fcee4/docs/data-prep.html" target="_blank">76b55b6</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/949244ef8a7608b4e621d35d5738e4be958e9eeb/analysis/data-prep.Rmd" target="_blank">949244e</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c921da2e03875a665ad9757ac84b87d2df0390db/analysis/data-prep.Rmd" target="_blank">c921da2</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Created Figure S3 to respond to a reviewers comments
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/4a00400e48547b38143afcd0902428f869b59fbb/docs/data-prep.html" target="_blank">4a00400</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/0ab0ac64cd0809688faace11e05c3c514f39d9a1/analysis/data-prep.Rmd" target="_blank">0ab0ac6</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/65f38bf20fd32a9aeb2dcf7974bfd75b9d0e4116/docs/data-prep.html" target="_blank">65f38bf</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/b742b28cdb9a27ca944ce5ece9ad58e2d8f8e19d/analysis/data-prep.Rmd" target="_blank">b742b28</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/33f45959a9fe249be64a308272b3af8fc4337d3b/docs/data-prep.html" target="_blank">33f4595</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/a4382354948060f58c3aa118155807fb4fb4cff5/docs/data-prep.html" target="_blank">a438235</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-10
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/cbc5b749020fe72d28ecead35adc45c7734aaff3/analysis/data-prep.Rmd" target="_blank">cbc5b74</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-10
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/2e73a82555f15fcb9238a2e3cf8469157851bcba/analysis/data-prep.Rmd" target="_blank">2e73a82</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-05
</td>
<td>
Changed how magnitude and RMSE calculations were made
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/abed6b295e91d58b13e35285ca59138f8912cfce/analysis/data-prep.Rmd" target="_blank">abed6b2</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-05
</td>
<td>
Changing the way in which cumulative values are calculated
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/fdc115cce37cb92da773e0cb9c09ff4d92b07f25/analysis/data-prep.Rmd" target="_blank">fdc115c</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-10-08
</td>
<td>
Propogated the swr down values through the results
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/54144a7c30d7c6248923c2ac6e5cf0582399f35a/analysis/data-prep.Rmd" target="_blank">54144a7</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-28
</td>
<td>
Working on non-numeric node labels
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/d067646b335b5ccef3c04204e9004af6c42511b5/analysis/data-prep.Rmd" target="_blank">d067646</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-24
</td>
<td>
Update to magnitude shcematic and improved tables
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/ab4326cd9d0a9619bd77ab9988778804aa998a56/analysis/data-prep.Rmd" target="_blank">ab4326c</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-03
</td>
<td>
Some changes for the site to be re-built
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/8d657581062aa4f04ebb53fd75a7cd27dc1fd62d/docs/data-prep.html" target="_blank">8d65758</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/de9c8294aff4621748d4debfd5eac1f878f863d7/analysis/data-prep.Rmd" target="_blank">de9c829</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-01
</td>
<td>
More work on follow up analyses
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/66f373644eb02230da1d4c7b36bac0e0fe314471/analysis/data-prep.Rmd" target="_blank">66f3736</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-26
</td>
<td>
More edits to the figures
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/d61c819dee29a606d1263e658449c8e1e1b6157a/analysis/data-prep.Rmd" target="_blank">d61c819</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-20
</td>
<td>
The full range of SOM figures
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/6b158497b419b1384ed5b82bd2e4d61d44165381/analysis/data-prep.Rmd" target="_blank">6b15849</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-18
</td>
<td>
More integration and optimisation of the code bases
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/84d175072e4a72c8ef86fbf6c35d79289e7fd710/analysis/data-prep.Rmd" target="_blank">84d1750</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-17
</td>
<td>
Finished porting over the SOM code. Still needs thorough testing.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/b029400893a29a02dd7a067469b4a60def7a482b/analysis/data-prep.Rmd" target="_blank">b029400</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-15
</td>
<td>
Re-calculated all of the base data
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/4b04d7ac56d17d823e5493369e25e2244fdd51be/analysis/data-prep.Rmd" target="_blank">4b04d7a</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-14
</td>
<td>
Renamed some files in preparation for the file runs on the SOM sized data
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/fd8772fa52ca70d116949ae870974a065c81b043/analysis/data-prep.Rmd" target="_blank">fd8772f</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-13
</td>
<td>
Finished new GLORYS processing
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/8da255f647221dc02ce0762f7b9c0ee05fa48357/analysis/data-prep.Rmd" target="_blank">8da255f</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-13
</td>
<td>
Removed ERA5 grid and calculated the FNN match between the GLORYS and OISST grids
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/3fca8acbed06441f358cc0e2395ade2a02c62254/analysis/data-prep.Rmd" target="_blank">3fca8ac</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-13
</td>
<td>
Removed the OISST and GLORYS MHW comparison code
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/f41bd24a2bfa8227b3000baca466a1dcb49d6c17/analysis/data-prep.Rmd" target="_blank">f41bd24</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-12
</td>
<td>
Experimenting with other NetCDF packages
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c0c599d0bc557985d1fe84ca87d9df2d6b56b2a2/analysis/data-prep.Rmd" target="_blank">c0c599d</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-08-12
</td>
<td>
Combining the MHWNWA and MHWflux code bases
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/192c062fe147c75961b0fb71d3b1864690621f7c/analysis/data-prep.Rmd" target="_blank">192c062</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-29
</td>
<td>
Propogated some small fixes through the pipeline to the results. Updated the shiny app accordingly.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/9304ba024770f98f060c655036c671d542ca05f6/docs/data-prep.html" target="_blank">9304ba0</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/49fd7535ffb218f79747d4872b93478d089a3cb3/analysis/data-prep.Rmd" target="_blank">49fd753</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-21
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/cf24288b882546ae3ed88dbd9260fdec86a16520/docs/data-prep.html" target="_blank">cf24288</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-17
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/ab06b9450f4ecad87d4e9f1510f82fc3cfc47869/docs/data-prep.html" target="_blank">ab06b94</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-14
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/8a8180ff5e4ae87ab0acfc528945c76be2820eb3/analysis/data-prep.Rmd" target="_blank">8a8180f</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-14
</td>
<td>
Performed 12 hour nudge on Wx terns. Completed RMSE calculations, comparisons, and integration into shiny app.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c5c1b35b8ff416c8aeec52ccbd6a588a64c57cff/analysis/data-prep.Rmd" target="_blank">c5c1b35</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-14
</td>
<td>
Working on RMSE code
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/f4e6cf532635c4eefe476ac9203b8603b7f2fa01/analysis/data-prep.Rmd" target="_blank">f4e6cf5</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-13
</td>
<td>
Changed Qx units from seconds to days
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/dfeee7aa3ba83cffb8014ea85bfe73892a4ac32f/analysis/data-prep.Rmd" target="_blank">dfeee7a</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-08
</td>
<td>
Some notes from today’s meeting
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/82215863ff88e966de1959c37597e1cebb6fd067/analysis/data-prep.Rmd" target="_blank">8221586</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-07-08
</td>
<td>
Updates to figures 2 and 3
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/40247a1d9b55be118d670fd967c3e1d7dc0855e5/analysis/data-prep.Rmd" target="_blank">40247a1</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-12
</td>
<td>
Shifted the SST from GLORYS to NOAA
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/97d0296594976b672058ad9436fd38f0c0e7424e/docs/data-prep.html" target="_blank">97d0296</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/0634d981eb9a55bd4cbd3e2d1e048403c8cfcb1f/docs/data-prep.html" target="_blank">0634d98</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/c6087d9b0fc349e3e566290d3406147941b13a73/docs/data-prep.html" target="_blank">c6087d9</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c8395116945de22fc1fd7a8e3698786c7512c1e9/analysis/data-prep.Rmd" target="_blank">c839511</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
<td>
Working back over some old thoughts
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/9e749bcb37fd3c207bcf0f3ac89858d111c50a70/analysis/data-prep.Rmd" target="_blank">9e749bc</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-05-28
</td>
<td>
First pass at connecting the SOM results to the correlations
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/09ce92584574a64ae7159c822b16936258818fc3/analysis/data-prep.Rmd" target="_blank">09ce925</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-05-20
</td>
<td>
Some work on comparing the OISST and GLORYS MHWs. They are somewhat different…
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/e837288d8a141c963718b407edd60941312fad30/analysis/data-prep.Rmd" target="_blank">e837288</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-05-19
</td>
<td>
A bunch of updates to the shiny app
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/12b4f673f911e7a1a646317e3a2d99a9e280c601/docs/data-prep.html" target="_blank">12b4f67</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/bc4ee87c0074d22538e8437ac26b25fdc8c74545/analysis/data-prep.Rmd" target="_blank">bc4ee87</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-28
</td>
<td>
Added more functionality to app. Added cloud coverage, speds, and precip-evap.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/29eb557406fe567f68bdd9096d93868752ab81c7/analysis/data-prep.Rmd" target="_blank">29eb557</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-27
</td>
<td>
Much progress on shiny app
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/7c043116bb0cc6102efc9fffb499b0029726650e/docs/data-prep.html" target="_blank">7c04311</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-22
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/99eda29f90adff0f3e31c25474df8597da58033a/docs/data-prep.html" target="_blank">99eda29</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-16
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/e4b95861ce2c9260a5610fb00bbaaaae312108bb/analysis/data-prep.Rmd" target="_blank">e4b9586</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-16
</td>
<td>
Re-built site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/f9637412b5478907314737bf693843fd21c2506d/analysis/data-prep.Rmd" target="_blank">f963741</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-15
</td>
<td>
Some text edits and published the shiny app
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/d22d6a7a8cd3f3b3ef7221ab0451123f81fd9f73/analysis/data-prep.Rmd" target="_blank">d22d6a7</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-04-14
</td>
<td>
Text edits
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/7c19a6fe94e087f0c0c7058a17a75eece2284529/analysis/data-prep.Rmd" target="_blank">7c19a6f</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-28
</td>
<td>
Notes from meeting with Ke.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/b10501eb1fa32d1fbc372d47a7eaeb541614c2e7/analysis/data-prep.Rmd" target="_blank">b10501e</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-27
</td>
<td>
Working on correlation code
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/robwschlegel/MHWflux/50eb5a58b28dae6acf8179bf4d8246cbf02c7ca7/docs/data-prep.html" target="_blank">50eb5a5</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/891e53a509c264f81c2ee2d56c6e0aee08256d13/analysis/data-prep.Rmd" target="_blank">891e53a</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Published site for first time.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/1be0a1e5a82a2212e4e01c5991f869151c9134c2/analysis/data-prep.Rmd" target="_blank">1be0a1e</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Completed the data prep for the project
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/bcd165b8ede9ebf5d79545978a681e3da5cbd309/analysis/data-prep.Rmd" target="_blank">bcd165b</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Writing
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/29883d6ae6bdaa72e902d1341593ad34aea8a7a7/analysis/data-prep.Rmd" target="_blank">29883d6</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Calculated the MHWs from GLORYS data. Am now wrestling with the pipeline for ERA5 loading.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c4343c013c244e3d4c13d3c184a115b4bc2a5c2d/analysis/data-prep.Rmd" target="_blank">c4343c0</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
<td>
Pushing quite a few changes
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/80324febbbc44b67b956f4684b205c17dbad130c/analysis/data-prep.Rmd" target="_blank">80324fe</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-25
</td>
<td>
Adding the foundational content to the site
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The purpose of this vignette is to walk through the steps taken to prepare the data from the NOAA OISST, ERA5, and GLORYS products for the following analyses. The statistical analyses may be found in the <a href="https://robwschlegel.github.io/MHWflux/mhw-flux.html">MHWs vs. heat flux</a> vignette, and the SOM analysis may be found in the <a href="https://robwschlegel.github.io/MHWflux/som.html">SOM</a> vignette.</p>
<p>All of the libraries and functions used in this vignette, and the project more broadly, may be found <a href="https://github.com/robwschlegel/MHWflux/blob/master/code/functions.R">here</a>.</p>
<pre class="r"><code># get everything up and running in one go
source(&quot;code/functions.R&quot;)
library(ggpubr)
library(gridExtra)
library(FNN)</code></pre>
</div>
<div id="study-area" class="section level2">
<h2>Study area</h2>
<p>A reminder of what the study area looks like. It has been cut into 6 regions, adapted from work by <span class="citation">Richaud et al. (2016)</span>.</p>
<pre class="r"><code>frame_base +
  geom_polygon(data = NWA_coords, alpha = 0.7, size = 2,
               aes(fill = region, colour = region)) +
  geom_polygon(data = map_base, aes(group = group))</code></pre>
<p><img src="figure/data-prep.Rmd/region-fig-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-region-fig-1">
Past versions of region-fig-1.png
</button>
</p>
<div id="fig-region-fig-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/a4382354948060f58c3aa118155807fb4fb4cff5/docs/figure/data-prep.Rmd/region-fig-1.png" target="_blank">a438235</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-10
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/50eb5a58b28dae6acf8179bf4d8246cbf02c7ca7/docs/figure/data-prep.Rmd/region-fig-1.png" target="_blank">50eb5a5</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="pixels-per-region" class="section level2">
<h2>Pixels per region</h2>
<p>We will now calculate which pixels fall within which region so we can later determine how to create our average SST time series per region as well as the other averaged heat flux, atmospheric, and oceanic time series.</p>
<p>For the SOM we will want to have everything on the same 1/4 degree grid. For the ERA5 data this is an easy shift to make, but for the GLORYS 1/12 degree data we want to ensure that these smaller pixels are being matched correctly to the nearest centre of an OISST pixels. To do this we will create an index of pairings using a fastest nearest neighbour search.</p>
<pre class="r"><code># Load one OISST file to extract the lon/lat coords
OISST_grid &lt;- readRDS(&quot;../data/OISST/daily/1982/daily.1982-01-01.Rda&quot;) %&gt;% 
  dplyr::select(lon, lat) %&gt;% 
  filter(lon &gt;= NWA_corners[1], lon &lt;= NWA_corners[2],
         lat &gt;= NWA_corners[3], lat &lt;= NWA_corners[4]) %&gt;% 
  unique() %&gt;% 
  mutate(OISST_index = 1:n()) # For merging to GLORYS grid
saveRDS(OISST_grid[,1:2], &quot;metadata/OISST_grid.Rda&quot;)

# Load one high-res GLORYS file to extract the lon/lat coords
GLORYS_grid_base &lt;- tidync(GLORYS_files[1]) %&gt;% 
  hyper_tibble() %&gt;% 
  dplyr::rename(lon = longitude, lat = latitude) %&gt;% 
  filter(lon &gt;= NWA_corners[1], lon &lt;= NWA_corners[2],
         lat &gt;= NWA_corners[3], lat &lt;= NWA_corners[4]) %&gt;% 
  dplyr::select(lon, lat) %&gt;% 
  unique()

# Add on the nearest OISST coords
GLORYS_grid &lt;- GLORYS_grid_base %&gt;% 
  mutate(OISST_index = as.vector(knnx.index(as.matrix(OISST_grid[,c(&quot;lon&quot;, &quot;lat&quot;)]),
                                            as.matrix(GLORYS_grid_base[,c(&quot;lon&quot;, &quot;lat&quot;)]), k = 1))) %&gt;%
  left_join(OISST_grid, by = &quot;OISST_index&quot;) %&gt;% 
  dplyr::select(-OISST_index) %&gt;% 
  dplyr::rename(lon = lon.x, lat = lat.x, lon_OISST = lon.y, lat_OISST = lat.y)
saveRDS(GLORYS_grid, &quot;metadata/GLORYS_grid.Rda&quot;)

# Load one ERA5 file to get the lon/lat coords
ERA5_grid &lt;- tidync(ERA5_lhf_files[1]) %&gt;%
  hyper_filter(latitude = dplyr::between(latitude, NWA_corners[3], NWA_corners[4]),
               longitude = dplyr::between(longitude, NWA_corners[1]+360, NWA_corners[2]+360),
               time = index == 1) %&gt;%
  hyper_tibble() %&gt;%
  dplyr::rename(lon = longitude, lat = latitude) %&gt;%
  dplyr::select(lon, lat) %&gt;%
  mutate(lon = lon-360) %&gt;%  # Change back to +-180 scale
  mutate(lon = lon+0.125, lat = lat-0.125) %&gt;%  # Regrid to match OISST coords
  filter(lon &gt;= NWA_corners[1], lon &lt;= NWA_corners[2],
         lat &gt;= NWA_corners[3], lat &lt;= NWA_corners[4]) %&gt;% 
  unique()
saveRDS(ERA5_grid, &quot;metadata/ERA5_grid.Rda&quot;)

# Test visuals
  # Choose one
# OISST_grid %&gt;%
# GLORYS_grid %&gt;%
ERA5_grid %&gt;%
  ggplot(aes(x = lon, y = lat)) +
  geom_raster() +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = F)
  
# Function for finding and cleaning up points within a given region polygon
points_in_region &lt;- function(region_in, product_grid){
  region_sub &lt;- NWA_coords %&gt;% 
    filter(region == region_in)
  coords_in &lt;- product_grid %&gt;% 
    mutate(in_grid = sp::point.in.polygon(point.x = product_grid[[&quot;lon&quot;]], point.y = product_grid[[&quot;lat&quot;]], 
                                          pol.x = region_sub[[&quot;lon&quot;]], pol.y = region_sub[[&quot;lat&quot;]])) %&gt;% 
    filter(in_grid &gt;= 1) %&gt;% 
    mutate(region = region_in) %&gt;% 
    dplyr::select(lon, lat, region)
  return(coords_in)
}

# Run the function
registerDoParallel(cores = 10)
OISST_regions &lt;- plyr::ldply(unique(NWA_coords$region), points_in_region, 
                              .parallel = T, product_grid = OISST_grid)
saveRDS(OISST_regions, &quot;metadata/OISST_regions.Rda&quot;)
GLORYS_regions &lt;- plyr::ldply(unique(NWA_coords$region), points_in_region, 
                              .parallel = T, product_grid = GLORYS_grid)
saveRDS(GLORYS_regions, &quot;metadata/GLORYS_regions.Rda&quot;)
ERA5_regions &lt;- plyr::ldply(unique(NWA_coords$region), points_in_region, 
                            .parallel = T, product_grid = OISST_grid) # We only want ocean pixels
saveRDS(ERA5_regions, &quot;metadata/ERA5_regions.Rda&quot;)

# Test visuals
  # Choose one
# OISST_regions %&gt;%
# GLORYS_regions %&gt;%
ERA5_regions %&gt;%
  ggplot(aes(x = lon, y = lat)) +
  geom_raster(aes(fill = region)) +
  scale_x_continuous(breaks = seq(-80, -40, 2)) +
  scale_y_continuous(breaks = seq(32, 52, 2)) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = T)</code></pre>
<pre class="r"><code>OISST_regions &lt;- readRDS(&quot;metadata/OISST_regions.Rda&quot;)
GLORYS_regions &lt;- readRDS(&quot;metadata/GLORYS_regions.Rda&quot;)
ERA5_regions &lt;- readRDS(&quot;metadata/ERA5_regions.Rda&quot;)

# Combine for visual
ALL_regions &lt;- rbind(OISST_regions, GLORYS_regions, ERA5_regions) %&gt;%
  mutate(product = c(rep(&quot;OISST&quot;, nrow(OISST_regions)),
                     rep(&quot;GLORYS&quot;, nrow(GLORYS_regions)),
                     rep(&quot;ERA5&quot;, nrow(ERA5_regions))))

# Visualise to ensure success
ggplot(NWA_coords, aes(x = lon, y = lat)) +
  geom_polygon(data = map_base, aes(group = group), show.legend = F) +
  geom_point(data = ALL_regions, aes(colour = region), size = 0.1) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = F) +
  labs(x = NULL, y = NULL, colour = &quot;Region&quot;) +
  facet_wrap(~product) +
  guides(colour = guide_legend(override.aes = list(shape = 15, size = 5)))</code></pre>
<p><img src="figure/data-prep.Rmd/grid-points-visual-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-grid-points-visual-1">
Past versions of grid-points-visual-1.png
</button>
</p>
<div id="fig-grid-points-visual-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/a4382354948060f58c3aa118155807fb4fb4cff5/docs/figure/data-prep.Rmd/grid-points-visual-1.png" target="_blank">a438235</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-11-10
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/8d657581062aa4f04ebb53fd75a7cd27dc1fd62d/docs/figure/data-prep.Rmd/grid-points-visual-1.png" target="_blank">8d65758</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c6087d9b0fc349e3e566290d3406147941b13a73/docs/figure/data-prep.Rmd/grid-points-visual-1.png" target="_blank">c6087d9</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/50eb5a58b28dae6acf8179bf4d8246cbf02c7ca7/docs/figure/data-prep.Rmd/grid-points-visual-1.png" target="_blank">50eb5a5</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-02-26
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># ggsave(filename = &quot;output/NWA_product_regions.pdf&quot;, height = 5, width = 18)</code></pre>
<p>With our pixels per region determined we may now go about creating the average time series for each region from the OISST, GLORYS, and ERA5 data.</p>
</div>
<div id="oisst-data-processing" class="section level2">
<h2>OISST data processing</h2>
<p>Up first for processing are the OISST data. The full brick of data within the study area will be loaded first. Then the pixels within the regions are pulled out and individual time series are made from each and saved. Finally the climatologies and anomalies for each pixel in the study area are calculated and saved. The region clims+anoms are calculated for all of the data at the same time near the end of this vignette.</p>
<pre class="r"><code># The files with data in the study area
OISST_files_sub &lt;- data.frame(files = OISST_files,
                              lon = c(seq(0.125, 179.875, by = 0.25), 
                                      seq(-179.875, -0.125, by = 0.25))) %&gt;% 
  filter(lon &gt;= NWA_corners[1], lon &lt;= NWA_corners[2]) %&gt;% 
  mutate(files = as.character(files))

# Load the full grid for the study area
system.time(
OISST_all &lt;- plyr::ldply(OISST_files_sub$files, .fun = load_OISST, .parallel = TRUE)
) # 16 seconds

# Check that the coords were subsetted correctly
NWA_corners
min(OISST_all$lon); max(OISST_all$lon)
min(OISST_all$lat); max(OISST_all$lat)

# test visual
OISST_all %&gt;%
  filter(t == &quot;1993-01-01&quot;) %&gt;%
  ggplot(aes(x = lon, y = lat)) +
  geom_raster(aes(fill = temp)) +
  scale_x_continuous(breaks = seq(-80, -40, 2)) +
  scale_y_continuous(breaks = seq(32, 52, 2)) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = T)

# Create the region time series and save
system.time(
OISST_all_ts &lt;- OISST_all %&gt;%
  right_join(OISST_regions, by = c(&quot;lon&quot;, &quot;lat&quot;)) %&gt;% 
  group_by(region, t) %&gt;%
  summarise(temp = mean(temp, na.rm = T), .groups = &quot;drop&quot;)
) # 14 seconds
saveRDS(OISST_all_ts, &quot;data/OISST_all_ts.Rda&quot;)

# test visual
OISST_all_ts %&gt;% 
  ggplot(aes(x = t, y = temp)) + 
  geom_line(aes(colour = region)) +
  facet_wrap(~region) +
  labs(x = NULL, y = &quot;Temp. (C)&quot;)

# Calculate the clims and anoms for each pixel
registerDoParallel(cores = 25)
system.time(
OISST_all_anom &lt;- OISST_all %&gt;% 
  mutate(var = &quot;temp&quot;) %&gt;% 
  dplyr::rename(val = temp) %&gt;% 
  plyr::ddply(., c(&quot;lon&quot;, &quot;lat&quot;, &quot;var&quot;), calc_clim_anom, .parallel = T, point_accuracy = 2)
) # 214 seconds
saveRDS(OISST_all_anom, &quot;data/OISST_all_anom.Rda&quot;)

# test visual
OISST_all_anom %&gt;%
  filter(t == &quot;1998-06-18&quot;) %&gt;% 
  ggplot(aes(x = lon, y = lat)) + 
  geom_polygon(data = map_base, aes(group = group), show.legend = F) +
  geom_tile(aes(fill = anom)) +
  scale_x_continuous(breaks = seq(-80, -40, 2)) +
  scale_y_continuous(breaks = seq(32, 52, 2)) +
  scale_fill_gradient2(low = &quot;blue&quot;, high = &quot;red&quot;) +
  labs(x = NULL, y = NULL) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = T) </code></pre>
</div>
<div id="glorys-data-processing" class="section level2">
<h2>GLORYS data processing</h2>
<p>We are using the 1/12 degree GLORYS product for the calculations of the region time series in order to better capture the sub-mesoscale processes that may be associated with the driving of MHWs. For the broad synoptic scale data given to the SOM we will be using the 1/4 degree GLORYS product as it needs to be the same resolution as the other products being used.</p>
<pre class="r"><code># NB: This is very RAM heavy, be careful with core use

# Process and save the region time series
registerDoParallel(cores = 25)
system.time(
GLORYS_all_ts &lt;- plyr::ldply(GLORYS_files, load_GLORYS, .parallel = T, region = T) %&gt;%
  dplyr::arrange(region, t) %&gt;% 
  mutate(cur_spd = round(sqrt(u^2 + v^2), 4),
         cur_dir = round((270-(atan2(v, u)*(180/pi)))%%360))
) # 202 seconds on 25 cores
saveRDS(GLORYS_all_ts, &quot;data/GLORYS_all_ts.Rda&quot;)

# test visual
GLORYS_all_ts %&gt;% 
  ggplot(aes(x = t, y = mld)) + 
  geom_line(aes(colour = region)) +
  facet_wrap(~region) +
  labs(x = NULL, y = &quot;MLD (m)&quot;)

# Load and prep the GLORYS data for the entire study area
registerDoParallel(cores = 25)
system.time(
GLORYS_all &lt;- plyr::ldply(GLORYS_files, load_GLORYS, 
                          .parallel = T, .paropts = c(.inorder = FALSE))
) # 293 seconds on 25 cores

# test visual
GLORYS_all %&gt;%
  filter(t == &quot;1993-01-01&quot;) %&gt;%
  ggplot(aes(x = lon, y = lat)) +
  geom_raster(aes(fill = mld)) +
  scale_x_continuous(breaks = seq(-80, -40, 2)) +
  scale_y_continuous(breaks = seq(32, 52, 2)) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = T)

# Calculates clims+anoms and save
registerDoParallel(cores = 25)
system.time(
GLORYS_all_anom &lt;- GLORYS_all %&gt;% 
  pivot_longer(cols = c(-lon, -lat, -t), names_to = &quot;var&quot;, values_to = &quot;val&quot;) %&gt;% 
  plyr::ddply(., c(&quot;lon&quot;, &quot;lat&quot;, &quot;var&quot;), calc_clim_anom, .parallel = T, 
              point_accuracy = 6, .paropts = c(.inorder = FALSE))
) # 732 seconds on 25 cores
saveRDS(GLORYS_all_anom, &quot;data/GLORYS_all_anom.Rda&quot;)

# test visual
GLORYS_all_anom %&gt;%
  filter(t == &quot;1993-06-18&quot;,
         var == &quot;mld&quot;) %&gt;% 
  ggplot(aes(x = lon, y = lat)) + 
  geom_polygon(data = map_base, aes(group = group), show.legend = F) +
  geom_tile(aes(fill = anom)) +
  scale_x_continuous(breaks = seq(-80, -40, 2)) +
  scale_y_continuous(breaks = seq(32, 52, 2)) +
  scale_fill_gradient2(low = &quot;blue&quot;, high = &quot;red&quot;) +
  labs(x = NULL, y = NULL) +
  coord_quickmap(xlim = NWA_corners[1:2], ylim = NWA_corners[3:4], expand = T) </code></pre>
</div>
<div id="era5-data-processing" class="section level2">
<h2>ERA5 data processing</h2>
<p>Note that the ERA5 data are on an hourly 1/4 degree spatiotemporal grid. This loading process constrains them to a daily 1/4 degree grid that matches the OISST data before finally converting them to a single time series per region.</p>
<pre class="r"><code># See the code/workflow script for the code used for ERA5 data prep
# There is too much code to run from an RMarkdown document as each variable must loaded individually</code></pre>
</div>
<div id="mhws-per-region" class="section level2">
<h2>MHWs per region</h2>
<p>We will be using the SST values from OISST for calculating the MHWs and will use the standard Hobday definition with a base period of 1993-01-01 to 2018-12-25. We are using an uneven length year as the GLORYS data do not quite extend to the end of December. It was decided that the increased accuracy of the climatology from the 2018 year outweighed the negative consideration of having a clim period that excludes a few days of winter.</p>
<pre class="r"><code># Load the data
OISST_all_ts &lt;- readRDS(&quot;data/OISST_all_ts.Rda&quot;)

# Calculate the MHWs
OISST_region_MHW &lt;- OISST_all_ts %&gt;%
  mutate(region = toupper(region)) %&gt;% 
  group_by(region) %&gt;%
  nest() %&gt;%
  mutate(clims = map(data, ts2clm,
                     climatologyPeriod = c(&quot;1993-01-01&quot;, &quot;2018-12-25&quot;)),
         events = map(clims, detect_event),
         cats = map(events, category, S = FALSE)) %&gt;%
  select(-data, -clims)

# Save
saveRDS(OISST_region_MHW, &quot;data/OISST_region_MHW.Rda&quot;)
saveRDS(OISST_region_MHW, &quot;shiny/OISST_region_MHW.Rda&quot;)</code></pre>
</div>
<div id="mhw-results" class="section level2">
<h2>MHW results</h2>
<p>There were some minor changes between the OISST grid used for the original SOM work and this version of the project. So first we want to compare the results of both to see by how much they differ. It should be very little.</p>
<pre class="r"><code># New and old MHW results
OISST_MHW_new &lt;- readRDS(&quot;data/OISST_region_MHW.Rda&quot;) %&gt;% 
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 0) %&gt;%
  unnest(events)
OISST_MHW_old &lt;- readRDS(&quot;../MHWNWA/data/OISST_region_MHW.Rda&quot;)  %&gt;% 
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 0) %&gt;%
  unnest(events)

## Max count of events per region
# New
OISST_MHW_new %&gt;% 
  group_by(region) %&gt;% 
  summarise(count = max(event_no))</code></pre>
<pre><code># A tibble: 6 x 2
  region count
  &lt;chr&gt;  &lt;int&gt;
1 CBS       53
2 GM        47
3 GSL       49
4 MAB       57
5 NFS       44
6 SS        41</code></pre>
<pre class="r"><code># Old
OISST_MHW_old %&gt;% 
  group_by(region) %&gt;% 
  summarise(count = max(event_no))</code></pre>
<pre><code># A tibble: 6 x 2
  region count
  &lt;chr&gt;  &lt;dbl&gt;
1 cbs       56
2 gm        45
3 gsl       48
4 mab       55
5 nfs       44
6 ss        41</code></pre>
<pre class="r"><code>## Average metrics
# New
OISST_MHW_new %&gt;% 
  dplyr::select(region, duration, intensity_mean, intensity_max, intensity_cumulative, rate_onset, rate_decline) %&gt;% 
  group_by(region) %&gt;% 
  summarise_all(&quot;mean&quot;, na.rm = T, .groups = &quot;drop&quot;)</code></pre>
<pre><code># A tibble: 6 x 7
  region duration intensity_mean intensity_max intensity_cumul… rate_onset
  &lt;chr&gt;     &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
1 CBS        13.3           1.76          2.12             24.7      0.172
2 GM         14.6           1.79          2.13             26.9      0.146
3 GSL        12.7           1.63          2.05             21.6      0.168
4 MAB        13.4           1.76          2.12             25.0      0.161
5 NFS        15.8           1.69          2.07             28.4      0.153
6 SS         18.1           1.99          2.43             37.7      0.192
# … with 1 more variable: rate_decline &lt;dbl&gt;</code></pre>
<pre class="r"><code># Old
OISST_MHW_old %&gt;% 
  dplyr::select(region, duration, intensity_mean, intensity_max, intensity_cumulative, rate_onset, rate_decline) %&gt;% 
  group_by(region) %&gt;% 
  summarise_all(&quot;mean&quot;, na.rm = T, .groups = &quot;drop&quot;)</code></pre>
<pre><code># A tibble: 6 x 7
  region duration intensity_mean intensity_max intensity_cumul… rate_onset
  &lt;chr&gt;     &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
1 cbs        12.7           1.73          2.09             23.6      0.178
2 gm         15.7           1.81          2.18             28.9      0.166
3 gsl        13.0           1.66          2.08             22.2      0.185
4 mab        14.4           1.77          2.13             26.8      0.155
5 nfs        15.7           1.69          2.06             28.2      0.154
6 ss         17.8           1.98          2.41             37.3      0.196
# … with 1 more variable: rate_decline &lt;dbl&gt;</code></pre>
<p>We can see from the results above that there are some minor differences between the results when using the different grids. This is regrettable as it will almost certainly have some sort of impact on the SOM results. But I think it is necessary that we press forward with results based on the OISST grid as it makes the most sense w.r.t. picking pixels that fall within the region polygons. This will also allow for better subsetting of pixels within the chosen study area.</p>
<p>Because the MHW results themselves are not really the focus of the paper, I will quickly go over them here. Specifically we are looking at the summary stats for MHWs per region and season, and how they may differ between those classifying groups. The stats created here are used in the results section of the manuscript and some of the musings will be used for the discussion.</p>
<pre class="r"><code># Annual count of MHWs - first MHW
OISST_MHW_event %&gt;%
  mutate(year = year(date_peak)) %&gt;% 
  group_by(year) %&gt;% 
  summarise(count = n(), .groups = &quot;drop&quot;) %&gt;% 
  data.frame()</code></pre>
<pre><code>   year count
1  1994     4
2  1998     1
3  1999    20
4  2000     6
5  2001     2
6  2002     2
7  2003     5
8  2004     1
9  2005     6
10 2006    12
11 2007     6
12 2008     8
13 2009     9
14 2010    15
15 2011    10
16 2012    61
17 2013    19
18 2014    21
19 2015    24
20 2016    28
21 2017    17
22 2018    14</code></pre>
<pre class="r"><code># Differences between regions
summary_region &lt;- OISST_MHW_event %&gt;% 
  dplyr::select(region, duration, intensity_mean, intensity_max, 
                intensity_cumulative, rate_onset, rate_decline) %&gt;% 
  mutate(region = toupper(region)) %&gt;% 
  dplyr::rename(group = region) %&gt;% 
  group_by(group) %&gt;% 
  # mutate(count = n()) %&gt;%
  ungroup() %&gt;%
  pivot_longer(duration:rate_decline) %&gt;% 
  group_by(group, name) %&gt;% 
  summarise(value_mean = round(mean(value), 1),
            value_sd = round(sd(value), 1), .groups = &quot;drop&quot;) %&gt;% 
  unite(&quot;value_summary&quot;, value_mean:value_sd, sep = &quot; ± &quot;) %&gt;% 
  pivot_wider(names_from = name, values_from = value_summary) %&gt;% 
  dplyr::rename(i_cum = intensity_cumulative, i_max = intensity_max, 
                i_mean = intensity_mean, r_decline = rate_decline, r_onset = rate_onset) %&gt;% 
  dplyr::select(group, duration, i_mean, i_max, i_cum, r_onset, r_decline)

# Differences between seasons
summary_season &lt;- OISST_MHW_event %&gt;% 
  ungroup() %&gt;% 
  dplyr::select(season, duration, intensity_mean, intensity_max, 
                intensity_cumulative, rate_onset, rate_decline) %&gt;% 
  dplyr::rename(group = season) %&gt;% 
  group_by(group) %&gt;% 
  # mutate(count = n()) %&gt;%
  ungroup() %&gt;%
  pivot_longer(duration:rate_decline) %&gt;% 
  group_by(group, name) %&gt;% 
  summarise(value_mean = round(mean(value), 1),
            value_sd = round(sd(value), 1), .groups = &quot;drop&quot;) %&gt;% 
  unite(&quot;value_summary&quot;, value_mean:value_sd, sep = &quot; ± &quot;) %&gt;% 
  pivot_wider(names_from = name, values_from = value_summary) %&gt;% 
  dplyr::rename(i_cum = intensity_cumulative, i_max = intensity_max, 
                i_mean = intensity_mean, r_decline = rate_decline, r_onset = rate_onset) %&gt;% 
  dplyr::select(group, duration, i_mean, i_max, i_cum, r_onset, r_decline)

# Table showing the mean +- SD per region and season
summary_region_season &lt;- rbind(summary_region, summary_season)
knitr::kable(summary_region_season)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">group</th>
<th align="left">duration</th>
<th align="left">i_mean</th>
<th align="left">i_max</th>
<th align="left">i_cum</th>
<th align="left">r_onset</th>
<th align="left">r_decline</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CBS</td>
<td align="left">13.3 ± 11.3</td>
<td align="left">1.8 ± 0.5</td>
<td align="left">2.1 ± 0.7</td>
<td align="left">24.7 ± 24.3</td>
<td align="left">0.2 ± 0.2</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="even">
<td align="left">GM</td>
<td align="left">14.6 ± 9.4</td>
<td align="left">1.8 ± 0.3</td>
<td align="left">2.1 ± 0.5</td>
<td align="left">26.9 ± 19.1</td>
<td align="left">0.1 ± 0.1</td>
<td align="left">0.2 ± 0.1</td>
</tr>
<tr class="odd">
<td align="left">GSL</td>
<td align="left">12.7 ± 10.9</td>
<td align="left">1.6 ± 0.6</td>
<td align="left">2 ± 0.8</td>
<td align="left">21.6 ± 19.6</td>
<td align="left">0.2 ± 0.1</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="even">
<td align="left">MAB</td>
<td align="left">13.4 ± 15.2</td>
<td align="left">1.8 ± 0.3</td>
<td align="left">2.1 ± 0.6</td>
<td align="left">25 ± 32.7</td>
<td align="left">0.2 ± 0.1</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="odd">
<td align="left">NFS</td>
<td align="left">15.8 ± 16.8</td>
<td align="left">1.7 ± 0.4</td>
<td align="left">2.1 ± 0.7</td>
<td align="left">28.4 ± 34.7</td>
<td align="left">0.2 ± 0.1</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="even">
<td align="left">SS</td>
<td align="left">18.1 ± 16.3</td>
<td align="left">2 ± 0.3</td>
<td align="left">2.4 ± 0.5</td>
<td align="left">37.7 ± 35.7</td>
<td align="left">0.2 ± 0.2</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="odd">
<td align="left">Spring</td>
<td align="left">13.3 ± 10.2</td>
<td align="left">1.9 ± 0.4</td>
<td align="left">2.4 ± 0.7</td>
<td align="left">26.8 ± 23.6</td>
<td align="left">0.2 ± 0.1</td>
<td align="left">0.2 ± 0.2</td>
</tr>
<tr class="even">
<td align="left">Summer</td>
<td align="left">13 ± 11.2</td>
<td align="left">2 ± 0.3</td>
<td align="left">2.4 ± 0.5</td>
<td align="left">26.9 ± 25.5</td>
<td align="left">0.2 ± 0.2</td>
<td align="left">0.3 ± 0.3</td>
</tr>
<tr class="odd">
<td align="left">Autumn</td>
<td align="left">15.8 ± 13.5</td>
<td align="left">1.7 ± 0.3</td>
<td align="left">2 ± 0.4</td>
<td align="left">28.2 ± 27.5</td>
<td align="left">0.1 ± 0.1</td>
<td align="left">0.1 ± 0.1</td>
</tr>
<tr class="even">
<td align="left">Winter</td>
<td align="left">16.7 ± 19.1</td>
<td align="left">1.3 ± 0.4</td>
<td align="left">1.6 ± 0.7</td>
<td align="left">26 ± 38.3</td>
<td align="left">0.1 ± 0.1</td>
<td align="left">0.1 ± 0.1</td>
</tr>
</tbody>
</table>
</div>
<div id="mhws-from-oisst-vs.-glorys" class="section level2">
<h2>MHWs from OISST vs. GLORYS</h2>
<p>In an earlier version of this analysis we had opted to use the GLORYS SST layer, but Ke pointed out that it may be better to use the NOAA OISST data. The reasoning being that because we are not fully closing the heat budget with GLORYS, there is no particular benefit to using the SST data from that modelled ensemble product. Rather it would be better to use the remotely observed NOAA OISST product as this is a more direct measure of the surface temperature of the ocean. Then again, there is a lot of benefit to just using two products instead of three. Particularly considering that all of the marine variables used here come from the GLORYS product. To that end the GLORYS and OISST MHWs must be compared to see if they are markedly different. If not, we will use the GLORYS SST data.</p>
<pre class="r"><code># Load the MHW calculations from the NOAA OISST data
OISST_region_MHW &lt;- readRDS(&quot;data/OISST_region_MHW.Rda&quot;)

# Load the GLORYS MHW data
GLORYS_region_MHW &lt;- readRDS(&quot;data/GLORYS_region_MHW.Rda&quot;)

# Extract the time series
OISST_MHW_clim &lt;- OISST_region_MHW %&gt;%
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 1) %&gt;%
  unnest(events) %&gt;% 
  mutate(product = &quot;OISST&quot;)
GLORYS_MHW_clim &lt;- GLORYS_region_MHW %&gt;%
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 1) %&gt;%
  unnest(events) %&gt;% 
  mutate(product = &quot;GLORYS&quot;,
         region = toupper(region))
MHW_clim &lt;- rbind(OISST_MHW_clim, GLORYS_MHW_clim) %&gt;% 
  mutate(anom = temp-seas)

# Extract the events
OISST_MHW_event &lt;- OISST_region_MHW %&gt;%
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 0) %&gt;%
  unnest(events) %&gt;% 
  mutate(product = &quot;OISST&quot;)
GLORYS_MHW_event &lt;- GLORYS_region_MHW %&gt;%
  select(-cats) %&gt;%
  unnest(events) %&gt;%
  filter(row_number() %% 2 == 0) %&gt;%
  unnest(events) %&gt;% 
  mutate(product = &quot;GLORYS&quot;,
         region = toupper(region))
MHW_event &lt;- rbind(OISST_MHW_event, GLORYS_MHW_event) %&gt;% 
  mutate(month_peak = lubridate::month(date_peak, label = T),
         season = case_when(month_peak %in% c(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;) ~ &quot;Winter&quot;,
                            month_peak %in% c(&quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;) ~ &quot;Spring&quot;,
                            month_peak %in% c(&quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;) ~ &quot;Summer&quot;,
                            month_peak %in% c(&quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;) ~ &quot;Autumn&quot;),
         season = factor(season, levels = c(&quot;Spring&quot;, &quot;Summer&quot;, &quot;Autumn&quot;, &quot;Winter&quot;))) %&gt;%
  select(-month_peak)

# Compare time series
MHW_clim_wide &lt;- MHW_clim %&gt;% 
  dplyr::select(product, region, doy, t, anom) %&gt;% 
  pivot_wider(names_from = product, values_from = anom) %&gt;% 
  mutate(t_diff = OISST-GLORYS)
MHW_clim_wide_monthly &lt;- MHW_clim_wide %&gt;% 
  mutate(t = round_date(t, unit = &quot;month&quot;)) %&gt;%
  group_by(region, t) %&gt;% 
  summarise(t_diff = mean(t_diff, na.rm = T), .groups = &quot;drop&quot;)

# Plot regional anomaly comparison
ts_comp &lt;- ggplot(data = MHW_clim_wide, aes(x = t, y = t_diff)) +
  geom_line(aes(colour = region), alpha = 0.5, show.legend = F) +
  geom_line(data = MHW_clim_wide_monthly, show.legend = F,
            aes(colour = region)) +
  geom_smooth(method = &quot;lm&quot;, show.legend = F) +
  facet_wrap(~region) +
  labs(x = &quot;Date&quot;, y = &quot;OISST anom. - GLORYS anom.&quot;, 
       title = &quot;Daily anomaly comparisons&quot;, 
       subtitle = paste0(&quot;Faint line shows daily differences, bold line shows monthly.&quot;,
                         &quot;\nStraight blue line shows linear trend in daily differences.&quot;))

# Plot the comparison of the seasonal and threshold signals
seas_thresh_comp &lt;- MHW_clim %&gt;% 
  dplyr::select(product, region, doy, seas, thresh) %&gt;%
  unique() %&gt;% 
  pivot_wider(names_from = product, values_from = c(seas, thresh)) %&gt;% 
  mutate(seas_diff = seas_OISST-seas_GLORYS,
         thresh_diff = thresh_OISST-thresh_GLORYS) %&gt;% 
  ggplot(aes(x = doy)) +
  geom_line(aes(y = seas_diff, colour = region), linetype = &quot;solid&quot;, show.legend = F) +
  geom_line(aes(y = thresh_diff, colour = region), linetype = &quot;dashed&quot;, show.legend = F) +
  facet_wrap(~region) +
  labs(x = &quot;Day-of-year (doy)&quot;, y = &quot;OISST clim. - GLORYS clim.&quot;,
       title = &quot;Difference per day-of-year (doy)&quot;,
       subtitle = paste0(&quot;Solid line shows seasonal climatology,&quot;,
                         &quot;\ndashed line shows threshold.&quot;))

# Plot average doy difference histogram
doy_comp &lt;- MHW_clim_wide %&gt;%
  group_by(region, doy) %&gt;% 
  summarise(doy_diff = mean(t_diff), .groups = &quot;drop&quot;) %&gt;% 
  ggplot(aes(x = doy_diff)) +
  geom_histogram(aes(fill = region), bins = 20, show.legend = F) +
  facet_wrap(~region) +
  labs(x = &quot;Mean difference (OISST - GLORYS) per doy&quot;,
       title = &quot;Distribution of mean differences per doy&quot;)

# Combine
OISST_GLORYS_ts_comp &lt;- ggarrange(ts_comp,
                                  ggarrange(seas_thresh_comp, doy_comp, ncol = 2, nrow = 1, align = &quot;hv&quot;, labels = c(&quot;B&quot;, &quot;C&quot;)),
                                  nrow = 2, labels = &quot;A&quot;, align = &quot;hv&quot;)
OISST_GLORYS_ts_comp</code></pre>
<p><img src="figure/data-prep.Rmd/GLORYS-OISST-comp-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-GLORYS-OISST-comp-1">
Past versions of GLORYS-OISST-comp-1.png
</button>
</p>
<div id="fig-GLORYS-OISST-comp-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/65f38bf20fd32a9aeb2dcf7974bfd75b9d0e4116/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-1.png" target="_blank">65f38bf</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/8d657581062aa4f04ebb53fd75a7cd27dc1fd62d/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-1.png" target="_blank">8d65758</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c6087d9b0fc349e3e566290d3406147941b13a73/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-1.png" target="_blank">c6087d9</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># ggsave(plot = OISST_GLORYS_ts_comp, filename = &quot;output/OISST_GLORYS_ts_comp.png&quot;, height = 8, width = 10)

# Compare MHW results
MHW_event_comp &lt;- MHW_event %&gt;% 
  group_by(product, region) %&gt;% 
  summarise(event_count = n(),
            dur = mean(duration),
            int_mean = mean(intensity_mean),
            int_cum_mean = mean(intensity_cumulative),
            int_max = max(intensity_max),
            onset = mean(rate_onset),
            decline = mean(rate_decline), .groups = &quot;drop&quot;) %&gt;% 
  ungroup() %&gt;%
  arrange(region, product) %&gt;% 
  mutate_if(is.numeric, round, 2) #%&gt;% 
  # pivot_wider(names_from = product, values_from = c(event_count:decline))
  # tableGrob(rows = NULL)

event_count_table &lt;- MHW_event_comp %&gt;% 
  dplyr::select(product:event_count) %&gt;% 
  pivot_wider(names_from = region, values_from = event_count) %&gt;% 
  tableGrob(rows = NULL)

# Boxplot of key variables
box_comp &lt;- MHW_event %&gt;% 
  dplyr::select(product, region, duration, intensity_mean,
                intensity_cumulative, intensity_max, rate_onset, rate_decline) %&gt;% 
  pivot_longer(cols = duration:rate_decline) %&gt;% 
  ggplot(aes(x = region, y = value, fill = region)) +
  geom_boxplot(aes(colour = product), notch = TRUE) +
  scale_colour_manual(values = c(&quot;black&quot;, &quot;red&quot;)) +
  facet_wrap(~name, scales = &quot;free_y&quot;) +
  labs(fill = &quot;Region&quot;, colour = &quot;Product&quot;, x = NULL, y = &quot;Value for given facet&quot;,
       title = &quot;Boxplots showing range of values for MHWs in each region&quot;)
# box_comp

OISST_GLORYS_MHW_comp &lt;- ggarrange(box_comp, event_count_table, ncol = 1, nrow = 2, 
                                   heights = c(8, 1), labels = c(&quot;A&quot;, &quot;B&quot;), align = &quot;hv&quot;)
OISST_GLORYS_MHW_comp</code></pre>
<p><img src="figure/data-prep.Rmd/GLORYS-OISST-comp-2.png" width="768" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-GLORYS-OISST-comp-2">
Past versions of GLORYS-OISST-comp-2.png
</button>
</p>
<div id="fig-GLORYS-OISST-comp-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/65f38bf20fd32a9aeb2dcf7974bfd75b9d0e4116/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-2.png" target="_blank">65f38bf</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-12-21
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/8d657581062aa4f04ebb53fd75a7cd27dc1fd62d/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-2.png" target="_blank">8d65758</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-09-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/robwschlegel/MHWflux/blob/c6087d9b0fc349e3e566290d3406147941b13a73/docs/figure/data-prep.Rmd/GLORYS-OISST-comp-2.png" target="_blank">c6087d9</a>
</td>
<td>
robwschlegel
</td>
<td>
2020-06-02
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># ggsave(plot = OISST_GLORYS_MHW_comp, filename = &quot;output/OISST_GLORYS_MHW_comp.png&quot;, height = 8, width = 10)

# Seasons within regions
MHW_event_season_comp &lt;- MHW_event %&gt;% 
  group_by(product, region, season) %&gt;% 
  summarise(event_count = n(),
            dur = mean(duration),
            int_mean = mean(intensity_mean),
            int_cum_mean = mean(intensity_cumulative),
            int_max = max(intensity_max),
            onset = mean(rate_onset),
            decline = mean(rate_decline), .groups = &quot;drop&quot;) %&gt;% 
  ungroup() %&gt;%
  arrange(region, season, product) %&gt;% 
  mutate_if(is.numeric, round, 2)
knitr::kable(MHW_event_season_comp)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">product</th>
<th align="left">region</th>
<th align="left">season</th>
<th align="right">event_count</th>
<th align="right">dur</th>
<th align="right">int_mean</th>
<th align="right">int_cum_mean</th>
<th align="right">int_max</th>
<th align="right">onset</th>
<th align="right">decline</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="left">Spring</td>
<td align="right">10</td>
<td align="right">17.00</td>
<td align="right">1.64</td>
<td align="right">31.58</td>
<td align="right">3.33</td>
<td align="right">0.15</td>
<td align="right">0.17</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="left">Spring</td>
<td align="right">7</td>
<td align="right">18.86</td>
<td align="right">1.76</td>
<td align="right">38.76</td>
<td align="right">4.58</td>
<td align="right">0.12</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="left">Summer</td>
<td align="right">16</td>
<td align="right">13.81</td>
<td align="right">2.02</td>
<td align="right">29.01</td>
<td align="right">3.55</td>
<td align="right">0.23</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="left">Summer</td>
<td align="right">20</td>
<td align="right">11.00</td>
<td align="right">2.08</td>
<td align="right">24.58</td>
<td align="right">3.88</td>
<td align="right">0.25</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="left">Autumn</td>
<td align="right">11</td>
<td align="right">18.64</td>
<td align="right">1.59</td>
<td align="right">30.09</td>
<td align="right">2.41</td>
<td align="right">0.09</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="left">Autumn</td>
<td align="right">17</td>
<td align="right">13.71</td>
<td align="right">1.69</td>
<td align="right">23.88</td>
<td align="right">2.86</td>
<td align="right">0.14</td>
<td align="right">0.13</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="left">Winter</td>
<td align="right">7</td>
<td align="right">16.14</td>
<td align="right">1.07</td>
<td align="right">17.68</td>
<td align="right">1.60</td>
<td align="right">0.04</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="left">Winter</td>
<td align="right">9</td>
<td align="right">13.33</td>
<td align="right">1.20</td>
<td align="right">15.68</td>
<td align="right">1.89</td>
<td align="right">0.09</td>
<td align="right">0.12</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="left">Spring</td>
<td align="right">9</td>
<td align="right">12.22</td>
<td align="right">1.54</td>
<td align="right">21.41</td>
<td align="right">3.61</td>
<td align="right">0.17</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="left">Spring</td>
<td align="right">7</td>
<td align="right">17.43</td>
<td align="right">1.87</td>
<td align="right">35.40</td>
<td align="right">3.56</td>
<td align="right">0.16</td>
<td align="right">0.13</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="left">Summer</td>
<td align="right">15</td>
<td align="right">17.33</td>
<td align="right">1.99</td>
<td align="right">36.49</td>
<td align="right">2.88</td>
<td align="right">0.15</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="left">Summer</td>
<td align="right">15</td>
<td align="right">12.73</td>
<td align="right">2.07</td>
<td align="right">26.93</td>
<td align="right">3.39</td>
<td align="right">0.20</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="left">Autumn</td>
<td align="right">12</td>
<td align="right">21.92</td>
<td align="right">1.74</td>
<td align="right">38.70</td>
<td align="right">2.44</td>
<td align="right">0.06</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="left">Autumn</td>
<td align="right">12</td>
<td align="right">16.92</td>
<td align="right">1.69</td>
<td align="right">29.16</td>
<td align="right">2.34</td>
<td align="right">0.10</td>
<td align="right">0.11</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="left">Winter</td>
<td align="right">7</td>
<td align="right">20.14</td>
<td align="right">1.41</td>
<td align="right">29.58</td>
<td align="right">2.30</td>
<td align="right">0.04</td>
<td align="right">0.06</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="left">Winter</td>
<td align="right">13</td>
<td align="right">13.00</td>
<td align="right">1.50</td>
<td align="right">20.29</td>
<td align="right">2.97</td>
<td align="right">0.12</td>
<td align="right">0.08</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="left">Spring</td>
<td align="right">10</td>
<td align="right">18.30</td>
<td align="right">1.89</td>
<td align="right">30.65</td>
<td align="right">3.10</td>
<td align="right">0.20</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="left">Spring</td>
<td align="right">12</td>
<td align="right">11.92</td>
<td align="right">1.98</td>
<td align="right">22.20</td>
<td align="right">3.91</td>
<td align="right">0.20</td>
<td align="right">0.33</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="left">Summer</td>
<td align="right">18</td>
<td align="right">14.67</td>
<td align="right">1.78</td>
<td align="right">27.19</td>
<td align="right">3.11</td>
<td align="right">0.16</td>
<td align="right">0.23</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="left">Summer</td>
<td align="right">19</td>
<td align="right">11.89</td>
<td align="right">1.96</td>
<td align="right">24.15</td>
<td align="right">3.57</td>
<td align="right">0.19</td>
<td align="right">0.32</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="left">Autumn</td>
<td align="right">9</td>
<td align="right">22.22</td>
<td align="right">1.47</td>
<td align="right">33.79</td>
<td align="right">2.30</td>
<td align="right">0.08</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="left">Autumn</td>
<td align="right">9</td>
<td align="right">14.22</td>
<td align="right">1.48</td>
<td align="right">22.14</td>
<td align="right">2.30</td>
<td align="right">0.13</td>
<td align="right">0.13</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="left">Winter</td>
<td align="right">3</td>
<td align="right">6.33</td>
<td align="right">0.63</td>
<td align="right">3.85</td>
<td align="right">0.90</td>
<td align="right">0.05</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="left">Winter</td>
<td align="right">9</td>
<td align="right">14.11</td>
<td align="right">0.63</td>
<td align="right">15.10</td>
<td align="right">2.47</td>
<td align="right">0.11</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="left">Spring</td>
<td align="right">11</td>
<td align="right">14.73</td>
<td align="right">1.91</td>
<td align="right">28.88</td>
<td align="right">3.43</td>
<td align="right">0.20</td>
<td align="right">0.19</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="left">Spring</td>
<td align="right">11</td>
<td align="right">8.91</td>
<td align="right">2.16</td>
<td align="right">20.02</td>
<td align="right">3.85</td>
<td align="right">0.26</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="left">Summer</td>
<td align="right">19</td>
<td align="right">13.00</td>
<td align="right">1.40</td>
<td align="right">18.85</td>
<td align="right">2.41</td>
<td align="right">0.12</td>
<td align="right">0.15</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="left">Summer</td>
<td align="right">21</td>
<td align="right">11.38</td>
<td align="right">1.65</td>
<td align="right">19.47</td>
<td align="right">3.30</td>
<td align="right">0.18</td>
<td align="right">0.21</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="left">Autumn</td>
<td align="right">10</td>
<td align="right">19.00</td>
<td align="right">1.63</td>
<td align="right">35.26</td>
<td align="right">3.28</td>
<td align="right">0.08</td>
<td align="right">0.10</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="left">Autumn</td>
<td align="right">14</td>
<td align="right">13.71</td>
<td align="right">1.62</td>
<td align="right">23.57</td>
<td align="right">3.30</td>
<td align="right">0.09</td>
<td align="right">0.16</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="left">Winter</td>
<td align="right">12</td>
<td align="right">17.08</td>
<td align="right">1.81</td>
<td align="right">33.39</td>
<td align="right">3.96</td>
<td align="right">0.10</td>
<td align="right">0.14</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="left">Winter</td>
<td align="right">11</td>
<td align="right">21.55</td>
<td align="right">1.74</td>
<td align="right">42.50</td>
<td align="right">4.16</td>
<td align="right">0.12</td>
<td align="right">0.10</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="left">Spring</td>
<td align="right">10</td>
<td align="right">17.00</td>
<td align="right">1.75</td>
<td align="right">30.26</td>
<td align="right">3.16</td>
<td align="right">0.17</td>
<td align="right">0.15</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="left">Spring</td>
<td align="right">11</td>
<td align="right">12.27</td>
<td align="right">1.83</td>
<td align="right">23.10</td>
<td align="right">3.31</td>
<td align="right">0.20</td>
<td align="right">0.16</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="left">Summer</td>
<td align="right">14</td>
<td align="right">19.86</td>
<td align="right">1.96</td>
<td align="right">40.57</td>
<td align="right">3.41</td>
<td align="right">0.15</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="left">Summer</td>
<td align="right">14</td>
<td align="right">17.79</td>
<td align="right">2.01</td>
<td align="right">37.60</td>
<td align="right">3.64</td>
<td align="right">0.20</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="left">Autumn</td>
<td align="right">7</td>
<td align="right">20.71</td>
<td align="right">1.52</td>
<td align="right">33.26</td>
<td align="right">2.27</td>
<td align="right">0.09</td>
<td align="right">0.09</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="left">Autumn</td>
<td align="right">10</td>
<td align="right">15.80</td>
<td align="right">1.65</td>
<td align="right">26.90</td>
<td align="right">2.74</td>
<td align="right">0.14</td>
<td align="right">0.12</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="left">Winter</td>
<td align="right">8</td>
<td align="right">30.25</td>
<td align="right">1.03</td>
<td align="right">36.61</td>
<td align="right">2.00</td>
<td align="right">0.04</td>
<td align="right">0.03</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="left">Winter</td>
<td align="right">9</td>
<td align="right">17.11</td>
<td align="right">1.06</td>
<td align="right">22.29</td>
<td align="right">2.06</td>
<td align="right">0.05</td>
<td align="right">0.10</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="left">Spring</td>
<td align="right">7</td>
<td align="right">21.43</td>
<td align="right">1.72</td>
<td align="right">42.00</td>
<td align="right">3.46</td>
<td align="right">0.14</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="left">Spring</td>
<td align="right">10</td>
<td align="right">14.00</td>
<td align="right">1.92</td>
<td align="right">29.25</td>
<td align="right">3.38</td>
<td align="right">0.20</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="left">Summer</td>
<td align="right">17</td>
<td align="right">13.88</td>
<td align="right">1.88</td>
<td align="right">27.68</td>
<td align="right">3.46</td>
<td align="right">0.15</td>
<td align="right">0.19</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="left">Summer</td>
<td align="right">16</td>
<td align="right">15.25</td>
<td align="right">2.15</td>
<td align="right">33.19</td>
<td align="right">3.13</td>
<td align="right">0.22</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="left">Autumn</td>
<td align="right">8</td>
<td align="right">26.12</td>
<td align="right">1.87</td>
<td align="right">52.53</td>
<td align="right">2.75</td>
<td align="right">0.08</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="left">Autumn</td>
<td align="right">8</td>
<td align="right">24.38</td>
<td align="right">2.04</td>
<td align="right">52.39</td>
<td align="right">3.17</td>
<td align="right">0.16</td>
<td align="right">0.12</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="left">Winter</td>
<td align="right">8</td>
<td align="right">23.50</td>
<td align="right">1.62</td>
<td align="right">40.92</td>
<td align="right">3.05</td>
<td align="right">0.10</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="left">Winter</td>
<td align="right">7</td>
<td align="right">23.43</td>
<td align="right">1.71</td>
<td align="right">43.03</td>
<td align="right">2.71</td>
<td align="right">0.15</td>
<td align="right">0.08</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Compare top 3 events per region
MHW_event_top &lt;- MHW_event %&gt;% 
  dplyr::select(product, everything()) %&gt;% 
  group_by(product, region) %&gt;% 
  dplyr::top_n(3, intensity_cumulative) %&gt;% 
  ungroup() %&gt;% 
  arrange(region, product) %&gt;% 
    dplyr::select(product, region, event_no, date_start, date_peak, date_end, duration, 
                  intensity_mean, intensity_cumulative, intensity_max, rate_onset, rate_decline)
knitr::kable(MHW_event_top)</code></pre>
<table style="width:100%;">
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="10%" />
<col width="15%" />
<col width="10%" />
<col width="7%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">product</th>
<th align="left">region</th>
<th align="right">event_no</th>
<th align="left">date_start</th>
<th align="left">date_peak</th>
<th align="left">date_end</th>
<th align="right">duration</th>
<th align="right">intensity_mean</th>
<th align="right">intensity_cumulative</th>
<th align="right">intensity_max</th>
<th align="right">rate_onset</th>
<th align="right">rate_decline</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="right">8</td>
<td align="left">1999-05-18</td>
<td align="left">1999-05-24</td>
<td align="left">1999-07-11</td>
<td align="right">55</td>
<td align="right">2.3509</td>
<td align="right">129.2968</td>
<td align="right">3.3311</td>
<td align="right">0.3042</td>
<td align="right">0.0358</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="right">22</td>
<td align="left">2010-12-14</td>
<td align="left">2010-12-28</td>
<td align="left">2011-02-13</td>
<td align="right">62</td>
<td align="right">1.4210</td>
<td align="right">88.1017</td>
<td align="right">1.7336</td>
<td align="right">0.0387</td>
<td align="right">0.0165</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">CBS</td>
<td align="right">27</td>
<td align="left">2012-04-15</td>
<td align="left">2012-05-25</td>
<td align="left">2012-06-05</td>
<td align="right">52</td>
<td align="right">1.7086</td>
<td align="right">88.8481</td>
<td align="right">2.2792</td>
<td align="right">0.0309</td>
<td align="right">0.0667</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="right">4</td>
<td align="left">1999-05-16</td>
<td align="left">1999-06-14</td>
<td align="left">1999-07-04</td>
<td align="right">50</td>
<td align="right">2.5021</td>
<td align="right">125.1048</td>
<td align="right">3.1152</td>
<td align="right">0.0596</td>
<td align="right">0.0622</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="right">18</td>
<td align="left">2010-12-16</td>
<td align="left">2010-12-22</td>
<td align="left">2011-02-09</td>
<td align="right">56</td>
<td align="right">1.4371</td>
<td align="right">80.4803</td>
<td align="right">1.9617</td>
<td align="right">0.1028</td>
<td align="right">0.0223</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">CBS</td>
<td align="right">26</td>
<td align="left">2012-08-04</td>
<td align="left">2012-08-28</td>
<td align="left">2012-08-31</td>
<td align="right">28</td>
<td align="right">2.5840</td>
<td align="right">72.3513</td>
<td align="right">3.2618</td>
<td align="right">0.0637</td>
<td align="right">0.4501</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="right">16</td>
<td align="left">2012-04-11</td>
<td align="left">2012-05-28</td>
<td align="left">2012-06-04</td>
<td align="right">55</td>
<td align="right">1.9869</td>
<td align="right">109.2778</td>
<td align="right">3.6064</td>
<td align="right">0.0511</td>
<td align="right">0.3032</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="right">32</td>
<td align="left">2015-12-07</td>
<td align="left">2015-12-27</td>
<td align="left">2016-02-12</td>
<td align="right">68</td>
<td align="right">1.6870</td>
<td align="right">114.7178</td>
<td align="right">2.0200</td>
<td align="right">0.0262</td>
<td align="right">0.0163</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GM</td>
<td align="right">42</td>
<td align="left">2018-08-05</td>
<td align="left">2018-08-17</td>
<td align="left">2018-09-23</td>
<td align="right">50</td>
<td align="right">2.2495</td>
<td align="right">112.4762</td>
<td align="right">2.8637</td>
<td align="right">0.1101</td>
<td align="right">0.0303</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="right">17</td>
<td align="left">2012-06-19</td>
<td align="left">2012-06-22</td>
<td align="left">2012-07-23</td>
<td align="right">35</td>
<td align="right">2.0946</td>
<td align="right">73.3107</td>
<td align="right">2.9133</td>
<td align="right">0.3867</td>
<td align="right">0.0448</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="right">34</td>
<td align="left">2015-12-12</td>
<td align="left">2015-12-27</td>
<td align="left">2016-01-18</td>
<td align="right">38</td>
<td align="right">1.7600</td>
<td align="right">66.8781</td>
<td align="right">2.3284</td>
<td align="right">0.0693</td>
<td align="right">0.0463</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GM</td>
<td align="right">43</td>
<td align="left">2017-10-09</td>
<td align="left">2017-10-23</td>
<td align="left">2017-11-19</td>
<td align="right">42</td>
<td align="right">1.8962</td>
<td align="right">79.6388</td>
<td align="right">2.3393</td>
<td align="right">0.0530</td>
<td align="right">0.0350</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="right">6</td>
<td align="left">2006-05-02</td>
<td align="left">2006-05-16</td>
<td align="left">2006-06-08</td>
<td align="right">38</td>
<td align="right">2.0900</td>
<td align="right">79.4199</td>
<td align="right">3.0976</td>
<td align="right">0.1162</td>
<td align="right">0.0598</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="right">15</td>
<td align="left">2010-02-19</td>
<td align="left">2010-04-26</td>
<td align="left">2010-05-06</td>
<td align="right">77</td>
<td align="right">1.2746</td>
<td align="right">98.1421</td>
<td align="right">2.3029</td>
<td align="right">0.0274</td>
<td align="right">0.0765</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">GSL</td>
<td align="right">18</td>
<td align="left">2010-12-03</td>
<td align="left">2010-12-24</td>
<td align="left">2011-03-08</td>
<td align="right">96</td>
<td align="right">1.4750</td>
<td align="right">141.6043</td>
<td align="right">2.3004</td>
<td align="right">0.0571</td>
<td align="right">0.0249</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="right">21</td>
<td align="left">2010-12-03</td>
<td align="left">2011-01-03</td>
<td align="left">2011-02-09</td>
<td align="right">69</td>
<td align="right">1.5174</td>
<td align="right">104.7007</td>
<td align="right">2.4713</td>
<td align="right">0.0401</td>
<td align="right">0.0564</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="right">29</td>
<td align="left">2012-07-28</td>
<td align="left">2012-08-27</td>
<td align="left">2012-08-31</td>
<td align="right">35</td>
<td align="right">2.3871</td>
<td align="right">83.5492</td>
<td align="right">3.3643</td>
<td align="right">0.0654</td>
<td align="right">0.4422</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">GSL</td>
<td align="right">46</td>
<td align="left">2016-11-14</td>
<td align="left">2016-11-20</td>
<td align="left">2016-12-12</td>
<td align="right">29</td>
<td align="right">1.8367</td>
<td align="right">53.2636</td>
<td align="right">2.2982</td>
<td align="right">0.1520</td>
<td align="right">0.0532</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="right">23</td>
<td align="left">2012-02-18</td>
<td align="left">2012-03-24</td>
<td align="left">2012-04-11</td>
<td align="right">54</td>
<td align="right">2.2572</td>
<td align="right">121.8880</td>
<td align="right">3.9615</td>
<td align="right">0.0718</td>
<td align="right">0.1235</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="right">24</td>
<td align="left">2012-04-16</td>
<td align="left">2012-04-21</td>
<td align="left">2012-06-04</td>
<td align="right">50</td>
<td align="right">2.0551</td>
<td align="right">102.7560</td>
<td align="right">2.7504</td>
<td align="right">0.1934</td>
<td align="right">0.0296</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">MAB</td>
<td align="right">38</td>
<td align="left">2015-11-03</td>
<td align="left">2015-12-31</td>
<td align="left">2016-01-19</td>
<td align="right">78</td>
<td align="right">2.1563</td>
<td align="right">168.1888</td>
<td align="right">3.2791</td>
<td align="right">0.0351</td>
<td align="right">0.0867</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="right">23</td>
<td align="left">2012-02-17</td>
<td align="left">2012-03-22</td>
<td align="left">2012-06-03</td>
<td align="right">108</td>
<td align="right">2.1561</td>
<td align="right">232.8615</td>
<td align="right">4.1560</td>
<td align="right">0.0819</td>
<td align="right">0.0309</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="right">37</td>
<td align="left">2015-08-16</td>
<td align="left">2015-09-10</td>
<td align="left">2015-09-25</td>
<td align="right">41</td>
<td align="right">1.8399</td>
<td align="right">75.4360</td>
<td align="right">2.5657</td>
<td align="right">0.0566</td>
<td align="right">0.0792</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">MAB</td>
<td align="right">39</td>
<td align="left">2015-12-10</td>
<td align="left">2015-12-30</td>
<td align="left">2016-01-06</td>
<td align="right">28</td>
<td align="right">2.3940</td>
<td align="right">67.0311</td>
<td align="right">3.2992</td>
<td align="right">0.0972</td>
<td align="right">0.2332</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="right">18</td>
<td align="left">2006-04-16</td>
<td align="left">2006-05-09</td>
<td align="left">2006-06-16</td>
<td align="right">62</td>
<td align="right">1.7691</td>
<td align="right">109.6832</td>
<td align="right">3.0425</td>
<td align="right">0.0906</td>
<td align="right">0.0393</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="right">26</td>
<td align="left">2010-12-15</td>
<td align="left">2011-01-10</td>
<td align="left">2011-03-25</td>
<td align="right">101</td>
<td align="right">1.4222</td>
<td align="right">143.6379</td>
<td align="right">1.9973</td>
<td align="right">0.0353</td>
<td align="right">0.0157</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">NFS</td>
<td align="right">33</td>
<td align="left">2012-07-30</td>
<td align="left">2012-08-12</td>
<td align="left">2012-11-19</td>
<td align="right">113</td>
<td align="right">2.0479</td>
<td align="right">231.4079</td>
<td align="right">3.0709</td>
<td align="right">0.0941</td>
<td align="right">0.0183</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="right">22</td>
<td align="left">2010-12-05</td>
<td align="left">2011-01-09</td>
<td align="left">2011-02-13</td>
<td align="right">71</td>
<td align="right">1.6389</td>
<td align="right">116.3617</td>
<td align="right">2.0624</td>
<td align="right">0.0216</td>
<td align="right">0.0384</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="right">34</td>
<td align="left">2012-07-25</td>
<td align="left">2012-08-08</td>
<td align="left">2012-10-21</td>
<td align="right">89</td>
<td align="right">2.2454</td>
<td align="right">199.8377</td>
<td align="right">3.3696</td>
<td align="right">0.1215</td>
<td align="right">0.0294</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">NFS</td>
<td align="right">41</td>
<td align="left">2014-07-26</td>
<td align="left">2014-07-31</td>
<td align="left">2014-08-28</td>
<td align="right">34</td>
<td align="right">2.1607</td>
<td align="right">73.4632</td>
<td align="right">3.6401</td>
<td align="right">0.3917</td>
<td align="right">0.0916</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="right">13</td>
<td align="left">2012-04-15</td>
<td align="left">2012-05-28</td>
<td align="left">2012-06-26</td>
<td align="right">73</td>
<td align="right">1.9321</td>
<td align="right">141.0404</td>
<td align="right">3.3902</td>
<td align="right">0.0503</td>
<td align="right">0.0700</td>
</tr>
<tr class="even">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="right">36</td>
<td align="left">2017-10-25</td>
<td align="left">2017-11-07</td>
<td align="left">2017-12-21</td>
<td align="right">58</td>
<td align="right">2.2008</td>
<td align="right">127.6466</td>
<td align="right">2.7477</td>
<td align="right">0.0797</td>
<td align="right">0.0271</td>
</tr>
<tr class="odd">
<td align="left">GLORYS</td>
<td align="left">SS</td>
<td align="right">37</td>
<td align="left">2018-02-19</td>
<td align="left">2018-03-08</td>
<td align="left">2018-04-20</td>
<td align="right">61</td>
<td align="right">2.0423</td>
<td align="right">124.5817</td>
<td align="right">3.0536</td>
<td align="right">0.1007</td>
<td align="right">0.0439</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="right">38</td>
<td align="left">2017-10-15</td>
<td align="left">2017-11-09</td>
<td align="left">2017-12-27</td>
<td align="right">74</td>
<td align="right">2.2502</td>
<td align="right">166.5145</td>
<td align="right">3.1673</td>
<td align="right">0.0561</td>
<td align="right">0.0337</td>
</tr>
<tr class="odd">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="right">39</td>
<td align="left">2018-02-12</td>
<td align="left">2018-03-16</td>
<td align="left">2018-04-18</td>
<td align="right">66</td>
<td align="right">1.9329</td>
<td align="right">127.5724</td>
<td align="right">2.7081</td>
<td align="right">0.0424</td>
<td align="right">0.0439</td>
</tr>
<tr class="even">
<td align="left">OISST</td>
<td align="left">SS</td>
<td align="right">41</td>
<td align="left">2018-08-06</td>
<td align="left">2018-09-19</td>
<td align="left">2018-09-24</td>
<td align="right">50</td>
<td align="right">2.1982</td>
<td align="right">109.9079</td>
<td align="right">2.8985</td>
<td align="right">0.0321</td>
<td align="right">0.2148</td>
</tr>
</tbody>
</table>
<p>From the figures and tables output from this comparison analysis we may see that there are some larger differences than were expected. Most importantly perhaps is the the MHWs in the OISST data are more numerous, intense, and shorter in duration. It appears that the GLORYS data assimilation methodology smooths the data more than what we see in the remotely sensed SST. In the peer-reviewed write-up this difference between OISST and GLORYS smoothness will need to be discussed. I think it still best to use the GLORYS data as the SST should match more closely to the flux terms considering they are also likely smoothed more than a different more direct sensing would report. There are arguments for and against the use of the SST from GLORYS or NOAA but looking at the SOM results with the different SST products it appears that the OISST allows for more meaningful nodes. So I’m now swapping out the GLORYS SST for NOAA and will see if the correlation results still hold up. (They did)</p>
</div>
<div id="region-clims-anoms-per-variable" class="section level2">
<h2>Region clims + anoms per variable</h2>
<p>The analyses to come are going to be performed on anomaly values, not the original time series. In order to calculate the anomalies we are first going to need the climatologies for each variable. We will use the Hobday definition of climatology creation and then subtract the expected climatology from the observed values. We are again using the 1993-01-01 to 2018-12-25 base period for these calculations to ensure consistency throughout the project. The daily air-sea heat flux values are first divided by the MLD on that day. The MLD value used to divide the daily variables accounts for the water density and specific heat constant: Q/(rho x Cp x hmld), where rho = 1024 and Cp ~= 4000. The Qnet term calculated this way approximates the air-sea flux term.</p>
<pre class="r"><code># Load the data
GLORYS_all_ts &lt;- readRDS(&quot;data/GLORYS_all_ts.Rda&quot;)
ERA5_all_ts &lt;- readRDS(&quot;data/ERA5_all_ts.Rda&quot;)
OISST_all_ts &lt;- readRDS(&quot;data/OISST_all_ts.Rda&quot;)
ALL_ts &lt;- left_join(ERA5_all_ts, GLORYS_all_ts, by = c(&quot;region&quot;, &quot;t&quot;)) %&gt;% 
  left_join(OISST_all_ts, by = c(&quot;region&quot;, &quot;t&quot;)) %&gt;% 
  filter(t &lt;= &quot;2018-12-31&quot;) %&gt;% 
  mutate(region = toupper(region))

# Calculate all clims and anoms
  # Also give better names to the variables
  # Also convert the Qx terms from seconds to days by multiplying by 86,400
ALL_ts_anom &lt;- ALL_ts %&gt;%
  dplyr::rename(lwr = msnlwrf, swr = swr_down, lhf = mslhf, 
                shf = msshf, mslp = msl, sst = temp.y) %&gt;% 
  dplyr::select(-wind_dir, -cur_dir, -temp.x) %&gt;% 
  mutate(qnet_mld = (qnet*86400)/(mld*1024*4000),
         lwr_mld = (lwr*86400)/(mld*1024*4000),
         swr_mld = (swr*86400)/(mld*1024*4000),
         lhf_mld = (lhf*86400)/(mld*1024*4000),
         shf_mld = (shf*86400)/(mld*1024*4000),
         mld_1 = 1/mld) %&gt;% 
  pivot_longer(cols = c(-region, -t), names_to = &quot;var&quot;, values_to = &quot;val&quot;) %&gt;% 
  group_by(region, var) %&gt;%
  nest() %&gt;%
  mutate(clims = map(data, ts2clm, y = val, roundClm = 10,
                     climatologyPeriod = c(&quot;1993-01-01&quot;, &quot;2018-12-25&quot;))) %&gt;% 
  dplyr::select(-data) %&gt;% 
  unnest(cols = clims) %&gt;%
  mutate(anom = val-seas) %&gt;% 
  ungroup()

# Save
saveRDS(ALL_ts_anom, &quot;data/ALL_ts_anom.Rda&quot;)
saveRDS(ALL_ts_anom, &quot;shiny/ALL_ts_anom.Rda&quot;)</code></pre>
</div>
<div id="cumulative-variables" class="section level2">
<h2>Cumulative variables</h2>
<p>We also need to create cumulative air-sea heat flux terms as well as a few other choice variables. This is done by taking the first day during a phase of a MHW and adding the daily values together cumulatively until the end of that phase.</p>
<p>The movement terms aren’t very useful and may not be worth including as they don’t really show advection. So rather one can say that the parts of the heating that aren’t explained by anything else could be attributed to advection through the process of elimination. For the moment they are still left in here.</p>
<pre class="r"><code># Event index used for calculations
OISST_MHW_event_index &lt;- OISST_MHW_event %&gt;% 
  ungroup() %&gt;% 
  mutate(row_index = 1:n())

# Wide anomaly dataframe to be used for cumulative calculations
ALL_ts_anom_wide &lt;- ALL_ts_anom %&gt;%
  dplyr::select(region, var, t, anom) %&gt;% 
  pivot_wider(id_cols = c(&quot;region&quot;, &quot;t&quot;), names_from = var, values_from = anom) %&gt;% 
  dplyr::select(region:tcc, mslp, qnet, p_e, mld, mld_1, qnet_mld:shf_mld, wind_spd)

# Calculate cumulative values based on MHW phases
ALL_ts_anom_cum &lt;- plyr::ddply(OISST_MHW_event_index, c(&quot;row_index&quot;), cum_phase, 
                               df = ALL_ts_anom_wide, .parallel = T) %&gt;% 
  dplyr::select(-row_index)

# Save
saveRDS(ALL_ts_anom_cum, &quot;data/ALL_ts_anom_cum.Rda&quot;)
saveRDS(ALL_ts_anom_cum, &quot;shiny/ALL_ts_anom_cum.Rda&quot;)</code></pre>
<p>In the <a href="https://robwschlegel.github.io/MHWflux/mhw-flux.html">MHWs vs. heat flux</a> vignette we will take the periods of time over which MHWs occurred per region and pair those up with the GLORYS and ERA5 data. This will be used to investigate which drivers are best related to the onset and decline of MHWs. In the <a href="https://robwschlegel.github.io/MHWNWA/som.html">SOM</a> vignette we will look for how the mean synoptic states during MHWs can best be clustered together.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<div id="refs">
<div id="ref-Richaud2016">
<p>Richaud, B., Kwon, Y.-O., Joyce, T. M., Fratantoni, P. S., and Lentz, S. J. (2016). Surface and bottom temperature and salinity climatology along the continental shelf off the canadian and us east coasts. <em>Continental Shelf Research</em> 124, 165–181.</p>
</div>
</div>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.1 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3

locale:
 [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8    
 [5] LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8   
 [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] gridExtra_2.3     ggpubr_0.4.0      doParallel_1.0.16 iterators_1.0.13 
 [5] foreach_1.5.1     FNN_1.1.3         Metrics_0.1.4     yasomi_0.3       
 [9] proxy_0.4-24      e1071_1.7-4       ggraph_2.0.4      correlation_0.5.0
[13] tidync_0.2.4      heatwaveR_0.4.5   lubridate_1.7.9.2 data.table_1.13.6
[17] forcats_0.5.0     stringr_1.4.0     dplyr_1.0.2       purrr_0.3.4      
[21] readr_1.4.0       tidyr_1.1.2       tibble_3.0.4      ggplot2_3.3.3    
[25] tidyverse_1.3.0  

loaded via a namespace (and not attached):
 [1] colorspace_2.0-0   ggsignif_0.6.0     ellipsis_0.3.1     class_7.3-17      
 [5] rio_0.5.16         rprojroot_2.0.2    parameters_0.10.1  fs_1.5.0          
 [9] rstudioapi_0.13    farver_2.0.3       graphlayouts_0.7.1 ggrepel_0.9.0     
[13] fansi_0.4.1        xml2_1.3.2         splines_4.0.3      codetools_0.2-18  
[17] ncdf4_1.17         knitr_1.30         polyclip_1.10-0    jsonlite_1.7.2    
[21] workflowr_1.6.2    broom_0.7.3        dbplyr_2.0.0       ggforce_0.3.2     
[25] effectsize_0.4.1   compiler_4.0.3     httr_1.4.2         backports_1.2.1   
[29] Matrix_1.2-18      assertthat_0.2.1   cli_2.2.0          later_1.1.0.1     
[33] tweenr_1.0.1       htmltools_0.5.1    tools_4.0.3        igraph_1.2.6      
[37] gtable_0.3.0       glue_1.4.2         Rcpp_1.0.5         carData_3.0-4     
[41] cellranger_1.1.0   RNetCDF_2.4-2      vctrs_0.3.6        nlme_3.1-150      
[45] insight_0.12.0     xfun_0.20          openxlsx_4.2.3     rvest_0.3.6       
[49] lifecycle_0.2.0    ncmeta_0.3.0       rstatix_0.6.0      MASS_7.3-53       
[53] scales_1.1.1       tidygraph_1.2.0    hms_1.0.0          promises_1.1.1    
[57] yaml_2.2.1         curl_4.3           stringi_1.5.3      highr_0.8         
[61] bayestestR_0.8.0   zip_2.1.1          rlang_0.4.10       pkgconfig_2.0.3   
[65] lattice_0.20-41    evaluate_0.14      labeling_0.4.2     cowplot_1.1.1     
[69] tidyselect_1.1.0   magrittr_2.0.1     R6_2.5.0           generics_0.1.0    
[73] DBI_1.1.1          mgcv_1.8-33        pillar_1.4.7       haven_2.3.1       
[77] whisker_0.4        foreign_0.8-79     withr_2.3.0        abind_1.4-5       
[81] modelr_0.1.8       crayon_1.3.4       car_3.0-10         utf8_1.1.4        
[85] rmarkdown_2.6      viridis_0.5.1      grid_4.0.3         readxl_1.3.1      
[89] git2r_0.28.0       reprex_0.3.0       digest_0.6.27      httpuv_1.5.5      
[93] munsell_0.5.0      viridisLite_0.3.0 </code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
